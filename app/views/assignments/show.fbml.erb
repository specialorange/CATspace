<%= render :partial =>"partials/activity_item_ajax_js_include" %>
<script type="text/javascript" charset="utf-8">
function doAjaxInPlaceEdit(field) {
	document.getElementById(field+'_field').setStyle("display","none");
	document.getElementById(field+'_editing_section').setStyle("display","block");	
	document.getElementById(field+'_saving_section').setStyle("display","none");		
  return false;
}

function doAjaxInPlaceSave(field) {
	document.getElementById(field+'_saving_section').setStyle("display","block");		
	id = <%=@assignment.id%>;
	value = document.getElementById(field+'_editor').getValue();
	url = '<%= url_for(:action => "edit_field", :canvas => false, :only_path => false,
  request_forgery_protection_token.to_s => h(form_authenticity_token()) ) %>';
	ajaxUpdateField(id, field, value, url);
  return false;
}

function doAjaxInPlaceCancel(field) {
	document.getElementById(field+'_field').setStyle("display","block");
	document.getElementById(field+'_editing_section').setStyle("display","none");		
	document.getElementById(field+'_saving_section').setStyle("display","none");		
  return false;
}	
</script>

<div class="assignmentHeader">  
	<div class="assignmentTitle">
		<div id="title_field" onMouseOver="flashObj(this);" onMouseOut="unFlashObj(this);" onClick="doAjaxInPlaceEdit('title');">
			<%= @assignment.title %>
		</div>
	</div>
	<div id="title_editing_section" style="display:none;">
		<input type="text" size="60" id="title_editor" value="<%=@assignment.title%>"/> 
		<div class="buttons">
			<button value="Save" onClick="doAjaxInPlaceSave('title');" class="positive">Save</button>
			<button value="Cancel" onClick="doAjaxInPlaceCancel('title');" class="negative">Cancel</button>
		</div>
	</div>
	<div id="title_saving_section" style="display:none;">
		<i>Saving...</i>
	</div>
	<div style="clear:both;">
		<%= fb_name(@assignment.facebook_user.uid, :firstnameonly => false, :useyou => true) %>
	</div>
</div>

<p>
  <%= render :partial => "linked_tag_list", :locals => { :list => @assignment.tag_list } %>
</p>

<div id="contentPanel">
	<p>
		<b>Rating: </b>
		<%= @assignment.rating%> <small>(Rated <%= @assignment.ratings.size%> times.)</small>
		<%= form_tag :action => "rate", :id => @assignment %>
		<%= select :rating, :value, {"-"=>"0","*" => "1","**"=>"2","***"=>"3","****"=>"4","*****"=>"5"} %>
		<%= submit_tag "Rate!"%>
		</form>
	</p>
	<p>
		<b>Synopsis:</b>
  		<div id="synopsis_field"  onMouseOver="flashObj(this);" onMouseOut="unFlashObj(this);" onClick="doAjaxInPlaceEdit('synopsis');"><%= textilize(@assignment.synopsis) %></div>
		<div id="synopsis_editing_section" style="display:none;">
			<textarea rows="20" cols="56" id="synopsis_editor"><%=@assignment.synopsis%></textarea><br>
			<div class="buttons">
				<button value="Save" onClick="doAjaxInPlaceSave('synopsis');" class="positive">Save</button>
				<button value="Cancel" onClick="doAjaxInPlaceCancel('synopsis');" class="negative">Cancel</button>
			</div>
		</div>
		<div id="synopsis_saving_section" style="display:none;">
			Saving...
		</div>
	</p>
<div id="file_list">
  <b>Files:</b>	
<% if @assignment.queue_flag %>
	<ul>
		<% for file in @assignment.files %>
			<li><%=file%></li>
		<% end %>
	</ul>
<% else %>
	No files uploaded.
<% end %>
</div>
<div class="boxHeaderFlexible">Comments</div>
<% for comment in @assignment.comments %>
<div id="comment">
<div id="commentUserIcon"><%= fb_profile_pic(comment.facebook_user.uid, options={:size => :thumb}) %></div>
<div id="commentText"><%= textilize(comment.body) %>
	<p><small>By <%= fb_name(comment.facebook_user.uid, options={:linked => true, :capitalize => true, :useyou => true})%></small></p>
	</div>
</div>
<% end %>
<div id="commentForm">
<%= form_tag :action => "comment" , :id => @assignment%>
	<%= text_area "comment", "body" %> <br>
	<%= submit_tag "Comment!"%>
</form>
</div>

</div> <!-- Content Panel -->

<div id="rightPanel">
	<div class="buttons">
		<a style="width:93%; clear:none;">Download Assignment</a>
	</div>

	<div class="boxHeaderFlexible">Files</div>
	<div style="height:200px"></div>

	<div class="boxHeaderFlexible">Recent activity</div>
	<%if @activity_items%>
		<% for activity_item in @activity_items %>
			<%= render :partial =>"partials/activity_item", :locals => {:activity_item => activity_item} %>
		<% end %>
	<%else%>
		There is no recent activity on this assignment.
	<% end %>

	<div class="boxHeaderFlexible">More by <%= fb_name(@assignment.facebook_user.uid, options={:firstnameonly => false, :linked => false, :useyou => true})%></div>
	<div style="height:200px"></div>
	
	
	
</div>
<div style="clear:both;">
	<hr>
	<%= link_to 'Edit', edit_assignment_path(@assignment) %> |
	<%= link_to 'All Assignments', assignments_path %><br>
</div>
<fb:iframe src="<%= iframe_url("assignments/ishow/#{@assignment.id}")%>" border="0" width="645" height="200" name="iFrameShow" scrolling="no" frameborder="0"></fb:iframe>

